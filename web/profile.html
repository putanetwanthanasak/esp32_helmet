<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile</title>
  <link rel="stylesheet" href="profile.css">
  </head>
<body>
  <div class="profile-box">
    <h2>Profile Information</h2>
    <div id="profileData"></div>
    <a href="index.html" class="back-btn">üîô Register Again</a>
  </div>

  <script type="module">
    // Import ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≤‡∏Å Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    // Config ‡∏Ç‡∏≠‡∏á Firebase (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡πÉ‡∏ô index.html)
    const firebaseConfig = {
      apiKey: "AIzaSyCZ-CrD57PuiwyU9axX5KLIusBVREiEOhM",
      authDomain: "helmetsafty.firebaseapp.com",
      databaseURL: "https://helmetsafty-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "helmetsafty",
      storageBucket: "helmetsafty.firebasestorage.app",
      messagingSenderId: "268114123475",
      appId: "1:268114123475:web:03906ae1d864c86d961226",
      measurementId: "G-GY1PXC9YEE"
    };

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
    document.addEventListener("DOMContentLoaded", () => {
      const profileDiv = document.getElementById("profileData");
      
      // 1. ‡∏î‡∏∂‡∏á 'uid' (‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) ‡∏à‡∏≤‡∏Å URL
      const params = new URLSearchParams(window.location.search);
      const userId = params.get("uid");

      if (userId) {
        // 2. ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ uid, ‡πÑ‡∏õ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å 'users/<userId>'
        const userRef = ref(db, 'users/' + userId);
        
        get(userRef).then((snapshot) => {
          if (snapshot.exists()) {
            // 3. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML
            const data = snapshot.val();
            
            // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏° 'data.userphone' ---
            profileDiv.innerHTML = `
              <div class="info"><span>Name:</span> ${data.firstname} ${data.lastname}</div>
              <div class="info"><span>Phone (ID):</span> ${data.userphone}</div>
              <div class="info"><span>Gender:</span> ${data.gender}</div>
              <div class="info"><span>Birthday:</span> ${data.bday}</div>
              <div class="info"><span>Blood Group:</span> ${data.bloodgroup}</div>
              <div class="info"><span>Underlying Diseases:</span> ${data.disease || '-'}</div>
              <div class="info"><span>Allergies:</span> ${data.allergy || '-'}</div>
              <div class="info"><span>Current Medications:</span> ${data.medication || '-'}</div>
              <div class="info"><span>Emergency Contact:</span> ${data.emergencyname}</div>
              <div class="info"><span>Emergency Phone:</span> ${data.emergencyphone}</div>
            `;
            // --- ‡∏à‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ---

          } else {
            // 4. ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ uid ‡πÅ‡∏ï‡πà‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠
            profileDiv.innerHTML = `<p>Error: Could not find profile data for ID: ${userId}</p>`;
          }
        }).catch((error) => {
          console.error("Firebase read error:", error);
          profileDiv.innerHTML = `<p>Error loading data. Please try again.</p>`;
        });

      } else {
        // 5. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ uid ‡πÉ‡∏ô URL
        profileDiv.innerHTML = `<p>No profile data found. Please <a href='index.html'>register</a> first.</p>`;
      }
    });
  </script>
</body>
</html>